<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
  <mapper namespace="com.kpsl.auction.bid.service.BidMapper">
  	<resultMap type="com.kpsl.auction.bid.vo.BidVo" id="Bid">
  		<id property="bidCode" column="bid_code"></id>
  		<id property="userBuyerId" column="user_buyer_id"></id>
		<id property="auctionGoodsCode" column="auction_goods_code"></id>
   		<id property="userSellerId" column="user_seller_id"></id>
  		<id property="bidPrice" column="bid_price"></id>
  		<id property="bidDate" column="bid_date"></id>
	</resultMap>
	 <!--입찰자 리스트  -->
	<select id="selectBidList" parameterType="java.util.Map" resultMap="Bid">
			SELECT bid_code
		 	,user_buyer_id
		 	,auction_goods_code
		 	,user_seller_id
		 	,bid_price
		 	,bid_date
		FROM bid_td;
  	</select>
  	<!--입찰-->
	<insert id="insertBidPrice" parameterType="com.kpsl.auction.bid.vo.BidVo"
			useGeneratedKeys="true" keyProperty="bidCode">
		<selectKey keyProperty="bidCode" resultType="string"
			order="BEFORE">
			SELECT CONCAT("bid",MAX(CAST(substring(bid_code,5)+1 AS
			DECIMAL))) FROM bid_tb
		</selectKey>
	INSERT INTO bid_td 
	(bid_code
	, user_buyer_id
	, auction_goods_code
	, user_seller_id
	, bid_price
	, bid_date)
	VALUES 
	('bid2'
	, 'id004'
	, 'good4'
	, 'id003'
	,  #{bidPrice}
	, NOW());
	</insert>
  </mapper>