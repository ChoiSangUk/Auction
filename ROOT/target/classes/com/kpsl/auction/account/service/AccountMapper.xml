<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kpsl.auction.account.service.AccountMapper">
	<resultMap type="com.kpsl.auction.account.vo.AccountVo" id="account">
		<id property="accountCode" column="account_code" />
		<result property="userId" column="user_id"/>
		<result property="accountBankName" column="account_bank_name" />
		<result property="accountHolderName" column="account_holder_name" />
		<result property="accountNo" column="account_no" />
		<result property="accountDate" column="account_date" />
	</resultMap>
	<!-- 캐쉬테이블에 충전내역 insert -->
	<insert id="insertAccount" parameterType="com.kpsl.auction.account.vo.AccountVo"
		useGeneratedKeys="true" keyProperty="accountCode">
		<selectKey keyProperty="accountCode" resultType="string" order="BEFORE">
			SELECT CONCAT("account",MAX(CAST(substring(account_code,8)+1 AS
			DECIMAL)))
			FROM account_tb
		</selectKey>
			INSERT INTO account_tb
			(account_code, user_id, account_bank_name, account_holder_name, account_no, account_date)
			VALUES (#{accountCode}, #{userId}, #{accountHolderName}, #{accountHolderName}, #{accountNo}, NOW())
	</insert>
	<!-- 캐쉬테이블충전내역으로 user캐쉬충전  -->
<!-- 	<update id="updateUserCash" parameterType="com.kpsl.auction.user.vo.UserDetailVo" >
			UPDATE user_detail_tb AS u INNER JOIN cash_tb AS c
			ON u.user_id = c.user_id
			SET u.user_totalcash = u.user_totalcash + c.cash_price
			WHERE u.user_id = #{userId} AND c.cash_code IN(
															SELECT CONCAT("cash",MAX(CAST(substring(cash_code,5) AS DECIMAL)))
															FROM cash_tb
														  );
	</update> -->
</mapper>